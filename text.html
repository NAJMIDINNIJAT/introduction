<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Generative Playground</title>
    <style>
        :root{--bg:#0b1020;--muted:rgba(255,255,255,0.65)}
        html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
        body{background:linear-gradient(120deg,#071026 0%, #07131a 50%, #05131b 100%);overflow:hidden;color:white}
        canvas{display:block;position:fixed;inset:0;z-index:0}
        .ui{position:fixed;left:20px;top:20px;z-index:2;backdrop-filter:blur(6px);background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06)}
        .title{font-weight:600;font-size:14px;margin-bottom:6px}
        .hint{font-size:12px;color:var(--muted);line-height:1.35}
        .overlay{position:fixed;right:20px;bottom:20px;z-index:2;text-align:right;padding:8px 12px;border-radius:10px;background:rgba(0,0,0,0.2);color:var(--muted);font-size:12px}
        .phrase{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:1;padding:8px 14px;border-radius:999px;background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.04);font-weight:600}
        .controls{display:flex;gap:8px;margin-top:8px}
        button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:6px 8px;border-radius:6px;font-size:12px;cursor:pointer}
        button:hover{border-color:rgba(255,255,255,0.12);color:white}
        small{display:block;color:rgba(255,255,255,0.35);margin-top:6px}
    </style>
</head>
<body>
    <canvas id="c"></canvas>

    <div class="ui">
        <div class="title">Generative Playground</div>
        <div class="hint">Move mouse to attract particles. Click to burst. Press C to clear, S to save image.</div>
        <div class="controls">
            <button id="toggleTrail">Toggle Trail</button>
            <button id="toggleText">Toggle Phrase</button>
            <button id="randomize">Randomize</button>
        </div>
        <small>Made for /Users/mark/研究室/text.html</small>
    </div>

    <div id="phrase" class="phrase" aria-live="polite">make something interesting</div>
    <div class="overlay" id="stats">Particles: 0</div>

    <script>
        const cvs = document.getElementById('c');
        const ctx = cvs.getContext('2d', { alpha: true });
        let W = window.innerWidth, H = window.innerHeight;
        cvs.width = W; cvs.height = H;

        const stats = document.getElementById('stats');
        const phraseEl = document.getElementById('phrase');
        const toggleTrailBtn = document.getElementById('toggleTrail');
        const toggleTextBtn = document.getElementById('toggleText');
        const randomizeBtn = document.getElementById('randomize');

        let trail = true;
        let showPhrase = true;

        const phrases = [
            "make something interesting",
            "研究室 — creative experiments",
            "particles, light, and noise",
            "こんにちは — hello world",
            "build, break, remix",
            "小さな爆発 — tiny bursts",
            "code is craft"
        ];

        function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
        phraseEl.textContent = pick(phrases);

        toggleTrailBtn.onclick = () => { trail = !trail; toggleTrailBtn.textContent = trail ? "Disable Trail" : "Enable Trail"; }
        toggleTextBtn.onclick = () => { showPhrase = !showPhrase; phraseEl.style.display = showPhrase ? "block" : "none"; }
        randomizeBtn.onclick = () => { hueBase = Math.random()*360; phraseEl.textContent = pick(phrases); spawnBurst(mouse.x||W/2, mouse.y||H/2, 120 + Math.floor(Math.random()*220)); }

        window.addEventListener('resize', () => {
            W = window.innerWidth; H = window.innerHeight;
            cvs.width = W; cvs.height = H;
        });

        // mouse
        const mouse = { x: W/2, y: H/2, down:false };
        window.addEventListener('mousemove', (e)=>{ mouse.x=e.clientX; mouse.y=e.clientY; });
        window.addEventListener('mousedown', ()=>{ mouse.down=true; spawnBurst(mouse.x, mouse.y, 140); });
        window.addEventListener('mouseup', ()=>{ mouse.down=false; });

        window.addEventListener('keydown', (e) => {
            if(e.key === 'c' || e.key === 'C'){ particles.length = 0; }
            if(e.key === 's' || e.key === 'S'){ saveImage(); }
        });

        function saveImage(){
            const link = document.createElement('a');
            link.download = 'generative.png';
            link.href = cvs.toDataURL('image/png');
            link.click();
        }

        // particles
        const particles = [];
        let hueBase = Math.random()*360;

        class Particle {
            constructor(x,y,angle,strength,life,chr){
                this.x = x; this.y = y;
                this.vx = Math.cos(angle)*strength * (0.6 + Math.random()*0.9);
                this.vy = Math.sin(angle)*strength * (0.6 + Math.random()*0.9);
                this.life = life || 100;
                this.age = 0;
                this.radius = 1 + Math.random()*3;
                this.hue = (hueBase + Math.random()*60 - 30 + (angle*10)) % 360;
                this.alpha = 1;
                this.chr = chr;
            }
            step(){
                // attraction to mouse
                const dx = mouse.x - this.x, dy = mouse.y - this.y;
                const dist = Math.max(20, Math.hypot(dx,dy));
                this.vx += (dx / dist) * (mouse.down ? 0.6 : 0.12);
                this.vy += (dy / dist) * (mouse.down ? 0.6 : 0.12);
                // slight noise
                this.vx += (Math.random()-0.5)*0.2;
                this.vy += (Math.random()-0.5)*0.2;
                this.x += this.vx;
                this.y += this.vy;
                this.age++;
                this.alpha = Math.max(0, 1 - this.age / this.life);
            }
            draw(ctx){
                ctx.save();
                ctx.globalCompositeOperation = 'lighter';
                ctx.fillStyle = `hsla(${this.hue},80%,60%,${this.alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
                ctx.fill();
                if(this.chr && Math.random() < 0.02){
                    ctx.fillStyle = `hsla(${this.hue+40},100%,85%,${this.alpha*0.9})`;
                    ctx.font = `${6 + this.radius*3}px ui-sans-serif,system-ui`;
                    ctx.fillText(this.chr, this.x-3, this.y+3);
                }
                ctx.restore();
            }
        }

        function spawnBurst(x,y,count=80){
            const baseAngle = Math.random()*Math.PI*2;
            for(let i=0;i<count;i++){
                const angle = baseAngle + (Math.random()*Math.PI*2);
                const strength = 1 + Math.random()*4;
                const life = 60 + Math.floor(Math.random()*140);
                const chr = Math.random() < 0.06 ? pick(['*','•','✦','✶','研究','lab','∞','♫']) : null;
                particles.push(new Particle(x,y,angle,strength,life,chr));
            }
        }

        // initial drift
        spawnBurst(W/2,H/2,180);

        function frame(){
            if(!trail){
                ctx.clearRect(0,0,W,H);
            } else {
                ctx.fillStyle = 'rgba(6,8,18,0.12)';
                ctx.fillRect(0,0,W,H);
            }

            // subtle background moving gradient dots
            for(let i=0;i<Math.min(6, particles.length); i++){
                // decorative, reuse particle color base
            }

            // update particles
            for(let i = particles.length-1; i>=0; i--){
                const p = particles[i];
                p.step();
                p.draw(ctx);
                if(p.age > p.life || p.x < -50 || p.x > W+50 || p.y < -50 || p.y > H+50) particles.splice(i,1);
            }

            // connect nearby particles lightly
            if(particles.length > 1){
                ctx.save();
                ctx.globalCompositeOperation = 'lighter';
                for(let i=0;i<Math.min(120, particles.length); i++){
                    const a = particles[i];
                    for(let j=i+1;j<Math.min(120, particles.length); j++){
                        const b = particles[j];
                        const dx = a.x - b.x, dy = a.y - b.y;
                        const d = dx*dx + dy*dy;
                        if(d < 1200){
                            ctx.strokeStyle = `hsla(${(a.hue+b.hue)/2},70%,60%,${(0.12 - d/1200*0.12).toFixed(3)})`;
                            ctx.lineWidth = 0.8;
                            ctx.beginPath();
                            ctx.moveTo(a.x,a.y);
                            ctx.lineTo(b.x,b.y);
                            ctx.stroke();
                        }
                    }
                }
                ctx.restore();
            }

            // gentle moving phrase hue animation
            if(showPhrase){
                phraseEl.style.filter = `drop-shadow(0 6px 18px rgba(0,0,0,0.6))`;
                phraseEl.style.color = `hsl(${(hueBase+ (Date.now()/50)%120)%360} 80% 85%)`;
            }

            stats.textContent = 'Particles: ' + particles.length;

            // ambient spawn near mouse
            if(Math.random() < 0.35){
                const mx = mouse.x || W/2, my = mouse.y || H/2;
                const a = (Math.random()*Math.PI*2);
                particles.push(new Particle(mx + (Math.random()-0.5)*10, my + (Math.random()-0.5)*10, a, 0.6 + Math.random()*1.2, 80 + Math.random()*100, null));
            }

            // slowly shift hue base
            hueBase = (hueBase + 0.02) % 360;

            requestAnimationFrame(frame);
        }

        frame();
    </script>
</body>
</html>